<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lexical Alchemy</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    height: 100vh;
    margin: 0;
    background: #f0f0f0;
  }
  #sidebar {
    width: 200px;
    background: white;
    padding: 10px;
    border-right: 2px solid #ccc;
    overflow-y: auto;
  }
  #sidebar h2 { font-size: 18px; margin: 0 0 10px; }
  .item {
    padding: 5px;
    margin: 3px 0;
    background: #d9f0ff;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
  }
  .item.selected {
    background: #ffd966;
  }
  #playArea {
    flex: 1;
    padding: 20px;
  }
  #result {
    font-size: 18px;
    margin-top: 20px;
    color: #333;
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Items</h2>
  <div id="itemsList"></div>
</div>

<div id="playArea">
  <h2>K·∫øt h·ª£p 2 item</h2>
  <p>Ch·ªçn 2 item t·ª´ danh s√°ch b√™n tr√°i ƒë·ªÉ th·ª≠ k·∫øt h·ª£p.</p>
  <div id="result"></div>
</div>

<script>
  let unlocked = [];
  let recipes = {};
  let selected = [];

  const itemsList = document.getElementById("itemsList");
  const resultBox = document.getElementById("result");

  // ==== V·∫Ω danh s√°ch item ====
  function renderItems() {
    itemsList.innerHTML = "";
    unlocked.sort().forEach(item => {
      const div = document.createElement("div");
      div.className = "item";
      if (selected.includes(item)) div.classList.add("selected");
      div.textContent = item;
      div.onclick = () => selectItem(item);
      itemsList.appendChild(div);
    });
  }

  // ==== Ch·ªçn item ====
  function selectItem(item) {
    if (selected.includes(item)) {
      selected = selected.filter(i => i !== item);
    } else {
      if (selected.length < 2) {
        selected.push(item);
      } else {
        selected = [item];
      }
    }
    if (selected.length === 2) tryCombine();
    renderItems();
  }

  // ==== Th·ª≠ k·∫øt h·ª£p ====
  function tryCombine() {
    const combo1 = selected[0] + "+" + selected[1];
    const combo2 = selected[1] + "+" + selected[0];
    const result = recipes[combo1] || recipes[combo2];

    if (result) {
      if (!unlocked.includes(result)) {
        unlocked.push(result);
        localStorage.setItem("unlockedItems", JSON.stringify(unlocked));
        resultBox.textContent = `üéâ B·∫°n ƒë√£ m·ªü kh√≥a: ${result}!`;
      } else {
        resultBox.textContent = `‚úÖ K·∫øt h·ª£p ƒë√∫ng nh∆∞ng b·∫°n ƒë√£ c√≥: ${result}.`;
      }
    } else {
      resultBox.textContent = "‚ùå Kh√¥ng th·ªÉ k·∫øt h·ª£p!";
    }

    selected = [];
    renderItems();
  }

  // ==== Load d·ªØ li·ªáu t·ª´ file ====
  Promise.all([
    fetch("items.txt").then(res => res.ok ? res.text() : Promise.reject()),
    fetch("recipes.txt").then(res => res.ok ? res.text() : Promise.reject())
  ]).then(([itemsText, recipesText]) => {
    
    // X·ª≠ l√Ω items
    const defaultItems = itemsText.trim().split(/\r?\n/).map(i => i.trim()).filter(i => i);
    unlocked = JSON.parse(localStorage.getItem("unlockedItems")) || defaultItems;

    // X·ª≠ l√Ω recipes
    recipesText.trim().split(/\r?\n/).forEach(line => {
      const [combo, result] = line.split("=");
      if (combo && result) {
        recipes[combo.trim()] = result.trim();
      }
    });

    renderItems();
  }).catch(err => {
    console.error("Kh√¥ng th·ªÉ load items.txt ho·∫∑c recipes.txt:", err);
    alert("‚ö† Kh√¥ng th·ªÉ load d·ªØ li·ªáu. Ki·ªÉm tra l·∫°i file .txt!");
  });
  // G√°n draggable cho m·ªói item
function renderItems() {
  itemsList.innerHTML = "";
  unlocked.sort().forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    div.textContent = item;
    div.draggable = true;

    // Khi b·∫Øt ƒë·∫ßu k√©o
    div.addEventListener("dragstart", e => {
      e.dataTransfer.setData("text/plain", item);
    });

    itemsList.appendChild(div);
  });
}

// Cho ph√©p drop v√†o khu v·ª±c ch∆°i
const playArea = document.getElementById("playArea");
let droppedItems = [];

playArea.addEventListener("dragover", e => {
  e.preventDefault(); // Cho ph√©p drop
});

playArea.addEventListener("drop", e => {
  e.preventDefault();
  const item = e.dataTransfer.getData("text/plain");

  // Hi·ªÉn th·ªã item ·ªü v·ªã tr√≠ th·∫£
  const span = document.createElement("div");
  span.textContent = item;
  span.className = "item";
  span.style.position = "absolute";
  span.style.left = e.offsetX + "px";
  span.style.top = e.offsetY + "px";
  playArea.appendChild(span);

  // L∆∞u l·∫°i item v·ª´a th·∫£ ƒë·ªÉ ki·ªÉm tra k·∫øt h·ª£p
  droppedItems.push(item);

  if (droppedItems.length === 2) {
    tryCombineDrag(droppedItems[0], droppedItems[1]);
    droppedItems = [];
  }
});

// K·∫øt h·ª£p khi th·∫£ 2 item
function tryCombineDrag(item1, item2) {
  const combo1 = item1 + "+" + item2;
  const combo2 = item2 + "+" + item1;
  const result = recipes[combo1] || recipes[combo2];

  if (result) {
    if (!unlocked.includes(result)) {
      unlocked.push(result);
      localStorage.setItem("unlockedItems", JSON.stringify(unlocked));
      alert(`üéâ B·∫°n ƒë√£ m·ªü kh√≥a: ${result}!`);
      renderItems();
    } else {
      alert(`‚úÖ B·∫°n ƒë√£ c√≥: ${result}.`);
    }
  } else {
    alert("‚ùå Kh√¥ng th·ªÉ k·∫øt h·ª£p!");
  }
}

</script>

</body>
</html>

