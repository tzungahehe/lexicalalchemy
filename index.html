// GÃ¡n draggable cho má»—i item
function renderItems() {
  itemsList.innerHTML = "";
  unlocked.sort().forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    div.textContent = item;
    div.draggable = true;

    // Khi báº¯t Ä‘áº§u kÃ©o
    div.addEventListener("dragstart", e => {
      e.dataTransfer.setData("text/plain", item);
    });

    itemsList.appendChild(div);
  });
}

// Cho phÃ©p drop vÃ o khu vá»±c chÆ¡i
const playArea = document.getElementById("playArea");
let droppedItems = [];

playArea.addEventListener("dragover", e => {
  e.preventDefault(); // Cho phÃ©p drop
});

playArea.addEventListener("drop", e => {
  e.preventDefault();
  const item = e.dataTransfer.getData("text/plain");

  // Hiá»ƒn thá»‹ item á»Ÿ vá»‹ trÃ­ tháº£
  const span = document.createElement("div");
  span.textContent = item;
  span.className = "item";
  span.style.position = "absolute";
  span.style.left = e.offsetX + "px";
  span.style.top = e.offsetY + "px";
  playArea.appendChild(span);

  // LÆ°u láº¡i item vá»«a tháº£ Ä‘á»ƒ kiá»ƒm tra káº¿t há»£p
  droppedItems.push(item);

  if (droppedItems.length === 2) {
    tryCombineDrag(droppedItems[0], droppedItems[1]);
    droppedItems = [];
  }
});

// Káº¿t há»£p khi tháº£ 2 item
function tryCombineDrag(item1, item2) {
  const combo1 = item1 + "+" + item2;
  const combo2 = item2 + "+" + item1;
  const result = recipes[combo1] || recipes[combo2];

  if (result) {
    if (!unlocked.includes(result)) {
      unlocked.push(result);
      localStorage.setItem("unlockedItems", JSON.stringify(unlocked));
      alert(`ğŸ‰ Báº¡n Ä‘Ã£ má»Ÿ khÃ³a: ${result}!`);
      renderItems();
    } else {
      alert(`âœ… Báº¡n Ä‘Ã£ cÃ³: ${result}.`);
    }
  } else {
    alert("âŒ KhÃ´ng thá»ƒ káº¿t há»£p!");
  }
}
